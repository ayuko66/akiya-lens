# 市区町村マスタ ETL 仕様書

## 目的
市区町村コード・名称などの基礎情報を整理し、各種オープンデータを結合するための「リファレンスマスタ」を生成する。

---

## 入力データ
- 総務省統計局公開の「全国地方公共団体コード」CSV（手動ダウンロード）
  - 例: `data/raw/FEA_hyoujun-YYYYMM.csv`
- 年次や提供形式により列名が揺れるため、**config/ref_project.yaml** の `columns_map` で吸収する。

---

## 出力
- `data/master/city_master__all__v1_YYYYMMDD.csv`

### 出力列（日本語）
- 市区町村コード（5桁ゼロ埋め文字列）
- 市区町村名
- 都道府県コード（2桁ゼロ埋め文字列）
- 都道府県名
- 市区町村ふりがな
- 政令市･郡･支庁･振興局等
- 政令市･郡･支庁･振興局等（ふりがな）
- 過疎地域市町村
- 都市種別

---

## 処理フロー

1. **入力CSV読み込み**
   - 文字コードは `cp932` / `shift_jis` / `utf-8-sig` / `utf-8` を自動判別
   - 数値コード列が float として解釈される場合は文字列化

2. **列名正規化**
   - `columns_map.city_master` を使って標準列にリネーム
   - 未対応列は空列として補完

3. **コード整形**
   - 市区町村コード: 5桁ゼロ埋め（例: `06367` → `"06367"`)
   - 都道府県コード: 市区町村コードの先頭2桁を抽出し、2桁ゼロ埋め

4. **不要列削除 & 列順統一**
   - 上記出力列に限定
   - 重複行は市区町村コードをキーに後勝ちで除去
   - 都道府県コード、市区町村コードでソート

5. **バリデーション**
   - 必須列: 市区町村コード, 市区町村名, 都道府県コード, 都道府県名
   - パターンチェック:
     - 市区町村コード: 正規表現 `^[0-9]{5}$`
     - 都道府県コード: 正規表現 `^[0-9]{2}$`

---

## 実行コマンド例
```bash
PYTHONPATH=. python scripts/ref/010_build_city_master_from_local_csv.py \
  --config config/ref_project.yaml \
  --src data/raw/FEA_hyoujun-202508.csv \
  --out data/master/city_master__all__v1_20250901.csv

