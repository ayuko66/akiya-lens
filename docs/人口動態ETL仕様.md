## 背景
- 空き家率データ（2018・2023）と組み合わせて学習用データマートを構築するため、人口動態データを整形するETLが必要。
- e-Stat「住民基本台帳に基づく人口、人口動態及び世帯数調査」から取得したCSVを対象とする。
- 年齢別人口は細分化された年齢階級（0–4歳, 5–9歳, …, 100歳以上）を集計して3区分（15歳未満, 15〜64歳, 65歳以上）にまとめる。

---

## 入力データ
- `data/raw/FEH_00450011_2509_population.csv` : （使用しない）※総人口は年齢別CSVから集計して使用
- `data/raw/FEH_00450011_2509_births.csv` : 出生数
- `data/raw/FEH_00450011_2509_deaths.csv` : 死亡数
- `data/raw/FEH_00200523_2509_moving_in.csv` : 転入数（2020–2023）
- `data/raw/FEH_00200523_2509_moving_out.csv` : 転出数（2020–2023）
- `data/raw/FEH_00200523_2509_2018_moving_in.csv` : 転入数（2018）
- `data/raw/FEH_00200523_2509_2018_moving_out.csv` : 転出数（2018）
- `data/raw/1804ssnen.csv` : 年齢別人口（2018, 性別=計を使用し総人口も算出）
- `data/raw/2204ssnen.csv` : 年齢別人口（2022 → 2023の代理, 性別=計を使用し総人口も算出）

---

## 出力データ
- 年別ファイル
  - `data/processed/population_stats_2018__v1__YYYYMMDD__[region].csv`
  - `data/processed/population_stats_2023__v1__YYYYMMDD__[region].csv`
- 縦持ちファイル
  - `data/processed/population_stats__v1__YYYYMMDD__[region].csv`

---

## 出力カラム
- 市区町村コード  
- 市区町村名  
- year  
- 総人口  
- 15歳未満人口  
- 15〜64歳人口  
- 65歳以上人口  
- 出生数  
- 死亡数  
- 転入者数  
- 転出者数  
- 高齢化率[%] = 65歳以上人口 / 総人口 × 100  
- 年少人口率[%] = 15歳未満人口 / 総人口 × 100  
- 生産年齢人口率[%] = 15〜64歳人口 / 総人口 × 100  
- 出生率[‰] = 出生数 / 総人口 × 1000  
- 死亡率[‰] = 死亡数 / 総人口 × 1000  
- 転入率[‰] = 転入者数 / 総人口 × 1000  
- 転出率[‰] = 転出者数 / 総人口 × 1000  
---

## 処理仕様
1. 各入力CSVを読み込み、共通キー（市区町村コード + year）でマージ。
2. 列名の揺れ（全角/半角、スペース、「歳/才」、「〜/～/−」など）は正規化。
3. 転入・転出は 2018年用CSVと2020–2023年用CSVを縦結合。
4. 年齢別人口CSVは「性別=計」行を対象とし、年齢階級を集計して3区分に変換。
   - 15歳未満 = 0–4, 5–9, 10–14  
   - 15〜64歳 = 15–19, 20–24, …, 60–64  
   - 65歳以上 = 65–69, 70–74, …, 95–99, 100歳以上  
5. 2022年の年齢別人口を2023年の代理値として扱う。
6. 欠損値はそのままNaN（率は計算できなければNaN）。
7. `study_regions` 設定に従い対象都道府県でフィルタリング。
8. 出力は年別CSVと縦持ちCSV（render_filenameによる日付展開）。

---

## 補足
- 年齢区分列は「50～54」「50-54」「50～54歳」など揺れがあるため、正規表現で吸収。
- 「100歳以上」は専用列が存在するため65歳以上人口に必ず加算。
- 後続で空き家率データとjoinして学習用マートを作成予定。
