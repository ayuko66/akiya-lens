# 気象データ取得・特徴量化 仕様書

## 背景
空き家リスクの説明・予測に使う気候指標（年平均気温・平均積雪量）を、市区町村単位の代表値として作成する。  
従来の30年平年値ではなく、直近数年（例：2018–2023）の平均を用いて、温暖化や積雪変動を反映させる。

---

## スコープ（本仕様①）
- メッシュ：1km（ベクターポリゴン or GeoTIFF）
- 対象変数：年平均気温、平均積雪量
- 代表値：**面積重み平均（Area-Weighted Mean）**
- 期間：**近年平均（例：2018–2023）**
- 出力：`data/processed/climate_city__v1.csv`

> 将来拡張②（メモ）：AMeDAS実測＋DEMを用いた回帰＋残差補間で1km格子を再推定し、市区町村平均を再作成

---

## 入出力

### 入力
 **市区町村境界ポリゴン**
   - 必須列: `city_code`, `city_name`, `geometry`
   - ソース: Wikidata境界キャッシュ or `.geojson`


 **設定YAML**
   - `etl_project.yaml` : region / prefecture_codes
   - `ref_project.yaml` : 列名エイリアス

### 出力
- CSV: `data/processed/climate_city__v1.csv`
市区町村コード,最高気温, 最低気温, 平均気温, 年最深積雪,年降水量
---

## 処理フロー
1. CRSを統一（EPSG:32654, UTM zone 54N）
2. 市区町村ポリゴンと気候メッシュを `overlay`
3. 交差面積を計算 → 欠損セルは除外
4. 市区町村内で面積比を正規化
5. 面積重み平均を算出
6. CSVへ出力

---

## 品質確認
- Σw == 1.0（市区町村ごとの重み合計）
- 欠損セル除外後に再正規化されている
- 高標高自治体ほど気温が低いなど地理的傾向が出ている

---

## 将来拡張（メモ）
- AMeDAS実測（2018–2023）から観測点ごとに平均を算出
- DEM（標高）を説明変数にした回帰＋残差補間
- 1kmグリッドを再構築して同じ集計器に流す
- 山岳地域（八ヶ岳など）の精度向上に有効


---
## 標高補正を加味した気候推定（改善施策）
	•	山地では観測所が少なく、1kmメッシュも標高差を十分反映できない場合がある。
	•	将来的には以下を導入することで精度向上を図る:
	1.	AMeDAS実測値（2018–2023）の年平均気温・積雪データを取得
	2.	標高（DEM: 数値標高モデル）を説明変数に追加
	3.	回帰式「気温 ≈ β0 + β1×標高」を構築し、残差をIDW補間
	4.	市区町村ポリゴンに集計して特徴量化
	•	特に八ヶ岳山麓地域のように標高差が大きい場合、この補正は住みやすさ推定の信頼性向上につながる。

⸻
